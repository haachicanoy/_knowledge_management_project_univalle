{
    "collab_server" : "",
    "contents" : "# Gestion del conocimiento - Proyecto Univalle: cargar y explorar datos\n# H. Achicanoy & C. Saavedra\n# 2017\n\n# R options\noptions(warn = -1); options(scipen = 999)\n\n# Load packages\nsuppressMessages(library(tidyverse))\nsuppressMessages(library(modelr))\nsuppressMessages(library(dplyr))\nsuppressMessages(library(purrr))\nsuppressMessages(library(broom))\nsuppressMessages(library(tidyr))\nsuppressMessages(library(ggplot2))\nsuppressMessages(library(FactoMineR))\nsuppressMessages(library(factoextra))\nsuppressMessages(library(foreign))\nsuppressMessages(library(haven))\nsuppressMessages(library(corrplot))\nsuppressMessages(library(polycor))\nsuppressMessages(library(psych))\nsuppressMessages(library(gplots))\nsuppressMessages(library(viridis))\nsuppressMessages(library(lsr))\n\n# ------------------------------------------------------- #\n# Loading data\n# ------------------------------------------------------- #\nkm_data <- read.spss(file = \"../_data/Base GConocimiento PymeS  Valle_2017.sav\", to.data.frame = T, use.value.labels = T) # F\nnames(km_data)\n\npilares <- km_data %>% select(P3_1:P3_8, P5_1:P9_6, P11_1:P13_16, P22_1:P25_5)\nfor(j in 1:ncol(pilares)){\n  pilares[,j] <- factor(pilares[,j], levels = c(\"Totalmente en desacuerdo\",\n                                                \"En desacuerdo\",\n                                                \"Ni de acuerdo ni en desacuerdo\",\n                                                \"De acuerdo\",\n                                                \"Totalmente de acuerdo\"), ordered = T)\n}; rm(j)\npilares %>% glimpse\npilares %>% str\n\n# ------------------------------------------------------- #\n# Pilar aprendizaje\n# ------------------------------------------------------- #\naprendizaje <- pilares %>% dplyr::select(P5_4, P5_5, P6_1, P6_2, P6_5, P7_2, P8_1, P13_13:P13_16)\naprendizaje %>% glimpse\n\n# Analisis descriptivo\nfqTable <- aprendizaje %>%\n  gather(measure, value) %>%\n  count(measure, value)\nnames(fqTable) <- c(\"Variable\", \"Categoria\", \"Frecuencia\")\nfqTable <- fqTable %>% dplyr::mutate(Porcentaje = Frecuencia/nrow(fqTable))\nfqTable$Categoria <- factor(fqTable$Categoria, levels = c(\"Totalmente en desacuerdo\",\n                               \"En desacuerdo\",\n                               \"Ni de acuerdo ni en desacuerdo\",\n                               \"De acuerdo\",\n                               \"Totalmente de acuerdo\"), ordered = T)\n\n# Plot it (SAVE IT!!!!)\nx11()\ngg <- fqTable %>% ggplot(aes(x = Categoria, y = Porcentaje*100)) +\n  geom_bar(stat = \"identity\") +\n  xlab(\"\") + ylab(\"Porcentaje (%)\") +\n  coord_flip() +\n  facet_wrap(~ Variable, scales = \"free\") +\n  theme_bw() +\n  theme(strip.text = element_text(size = 12, face = \"bold\")) +\n  theme(axis.title.x = element_text(size = 13, face = 'bold'),\n        axis.title.y = element_text(size = 13, face = 'bold'),\n        axis.text = element_text(size = 12))\nggsave(\"../_results/_descriptive_analysis/frecuencias_aprendizaje.png\", plot = gg, width = 22, height = 10, units = \"in\"); rm(fqTable, gg)\n\n# Chi-square test\noptions(warn=-1)\np.chisq = matrix(0, nrow=ncol(aprendizaje), ncol=ncol(aprendizaje), byrow=T)\nfor(i in 1:ncol(aprendizaje)){\n  for(j in 1:ncol(aprendizaje)){\n    p.chisq[i,j] = round(chisq.test(aprendizaje[,i],aprendizaje[,j])$p.value,3)\n  }\n}; rm(i); rm(j)\n\ndiag(p.chisq) = NA\ncolnames(p.chisq) = colnames(aprendizaje)\nrownames(p.chisq) = colnames(aprendizaje)\n\ncolor_scale = colorRampPalette(c(\"tomato3\",\"lightyellow\",\"lightseagreen\"), space=\"rgb\")(50)\npng(file = '../_results/_descriptive_analysis/chi_square_test_aprendizaje.png', height = 7, width = 7, units = \"in\", res = 300)\nheatmap.2(p.chisq,\n          main=\"Independence test Learning\",\n          key.title=\"Chi-square test\",\n          key.xlab=\"p-value\",\n          Rowv=F,\n          Colv=NULL,\n          col=color_scale,\n          linecol=NULL,\n          tracecol=NULL,\n          density.info=\"density\",\n          denscol=\"blue\",\n          margins=c(11,11))\ndev.off()#; rm(catVar, p.chisq, color_scale)\n\n# Cramer's V test\noptions(warn=-1)\np.cramer = matrix(0, nrow=ncol(aprendizaje), ncol=ncol(aprendizaje), byrow=T)\nfor(i in 1:ncol(aprendizaje)){\n  for(j in 1:ncol(aprendizaje)){\n    p.cramer[i,j] = round(lsr::cramersV(aprendizaje[,i],aprendizaje[,j]),3)\n  }\n}; rm(i); rm(j)\n\n# diag(p.cramer) = NA\ncolnames(p.cramer) = colnames(aprendizaje)\nrownames(p.cramer) = colnames(aprendizaje)\n\ncorrplot::corrplot(corr = p.cramer, method = \"square\")\n\n# ------------------------------------------------------- #\n# Pilar Tecnologia \n# ------------------------------------------------------- #\ntecnologia <- pilares %>% dplyr::select(P3_4, P5_6, P7_4, P7_5, P11_1:P11_5, P13_5, P13_6, P13_7, P13_8)\ntecnologia %>% glimpse\n\n# Analisis descriptivo\nfqTable2 <- tecnologia %>%\n  gather(measure, value) %>%\n  count(measure, value)\nnames(fqTable2) <- c(\"Variable\", \"Categoria\", \"Frecuencia\")\nfqTable2 <- fqTable2 %>% dplyr::mutate(Porcentaje = Frecuencia/nrow(fqTable2))\nfqTable2$Categoria <- factor(fqTable2$Categoria, levels = c(\"Totalmente en desacuerdo\",\n                                                          \"En desacuerdo\",\n                                                          \"Ni de acuerdo ni en desacuerdo\",\n                                                          \"De acuerdo\",\n                                                          \"Totalmente de acuerdo\"), ordered = T)\n\n# Plot it (SAVE IT!!!!)\nx11()\ngg <- fqTable2 %>% ggplot(aes(x = Categoria, y = Porcentaje*100)) +\n  geom_bar(stat = \"identity\") +\n  xlab(\"\") + ylab(\"Porcentaje (%)\") +\n  coord_flip() +\n  facet_wrap(~ Variable, scales = \"free\") +\n  theme_bw() +\n  theme(strip.text = element_text(size = 12, face = \"bold\")) +\n  theme(axis.title.x = element_text(size = 13, face = 'bold'),\n        axis.title.y = element_text(size = 13, face = 'bold'),\n        axis.text = element_text(size = 12))\nggsave(\"../_results/_descriptive_analysis/frecuencias_tecnologia.png\", plot = gg, width = 22, height = 10, units = \"in\"); rm(fqTable2, gg)\n\n\noptions(warn=-1)\np.chisq2 = matrix(0, nrow=ncol(tecnologia), ncol=ncol(tecnologia), byrow=T)\nfor(i in 1:ncol(tecnologia)){\n  for(j in 1:ncol(tecnologia)){\n    p.chisq2[i,j] = round(chisq.test(tecnologia[,i],tecnologia[,j])$p.value,3)\n  }\n}; rm(i); rm(j)\n\ndiag(p.chisq2) = NA\ncolnames(p.chisq2) = colnames(tecnologia)\nrownames(p.chisq2) = colnames(tecnologia)\n\ncolor_scale = colorRampPalette(c(\"tomato3\",\"lightyellow\",\"lightseagreen\"), space=\"rgb\")(50)\n# png('./_results/chi_test.png', height = 7, width = 7, units = \"in\", res = 300)\nheatmap.2(p.chisq2,\n          main=\"Independence test Technology\",\n          key.title=\"Chi-square test\",\n          key.xlab=\"p-value\",\n          Rowv=F,\n          Colv=NULL,\n          col=color_scale,\n          linecol=NULL,\n          tracecol=NULL,\n          density.info=\"density\",\n          denscol=\"blue\",\n          margins=c(11,11))\n\n# ------------------------------------------------------- #\n# Pilar Liderazgo \n# ------------------------------------------------------- #\nliderazgo <- pilares %>% dplyr::select(P3_1:P3_3, P3_5:P3_8, P8_3, P8_4, P8_5, P13_1, P13_2, P13_3, P13_4)\nliderazgo  %>% glimpse\n\n# Analisis descriptivo\nfqTable3 <- liderazgo  %>%\n  gather(measure, value) %>%\n  count(measure, value)\nnames(fqTable3) <- c(\"Variable\", \"Categoria\", \"Frecuencia\")\nfqTable3 <- fqTable3 %>% dplyr::mutate(Porcentaje = Frecuencia/nrow(fqTable3))\nfqTable3$Categoria <- factor(fqTable3$Categoria, levels = c(\"Totalmente en desacuerdo\",\n                                                            \"En desacuerdo\",\n                                                            \"Ni de acuerdo ni en desacuerdo\",\n                                                            \"De acuerdo\",\n                                                            \"Totalmente de acuerdo\"), ordered = T)\n\n# Plot it (SAVE IT!!!!)\nx11()\ngg <- fqTable3 %>% ggplot(aes(x = Categoria, y = Porcentaje*100)) +\n  geom_bar(stat = \"identity\") +\n  xlab(\"\") + ylab(\"Porcentaje (%)\") +\n  coord_flip() +\n  facet_wrap(~ Variable, scales = \"free\") +\n  theme_bw() +\n  theme(strip.text = element_text(size = 12, face = \"bold\")) +\n  theme(axis.title.x = element_text(size = 13, face = 'bold'),\n        axis.title.y = element_text(size = 13, face = 'bold'),\n        axis.text = element_text(size = 12))\nggsave(\"../_results/_descriptive_analysis/frecuencias_liderazgo.png\", plot = gg, width = 22, height = 10, units = \"in\"); rm(fqTable3, gg)\n\n\noptions(warn=-1)\np.chisq3 = matrix(0, nrow=ncol(liderazgo), ncol=ncol(liderazgo), byrow=T)\nfor(i in 1:ncol(liderazgo)){\n  for(j in 1:ncol(liderazgo)){\n    p.chisq3[i,j] = round(chisq.test(liderazgo[,i],liderazgo[,j])$p.value,3)\n  }\n}; rm(i); rm(j)\n\ndiag(p.chisq3) = NA\ncolnames(p.chisq3) = colnames(liderazgo)\nrownames(p.chisq3) = colnames(liderazgo)\n\ncolor_scale = colorRampPalette(c(\"tomato3\",\"lightyellow\",\"lightseagreen\"), space=\"rgb\")(50)\n# png('./_results/chi_test.png', height = 7, width = 7, units = \"in\", res = 300)\nheatmap.2(p.chisq3,\n          main=\"Independence test Leadership\",\n          key.title=\"Chi-square test\",\n          key.xlab=\"p-value\",\n          Rowv=F,\n          Colv=NULL,\n          col=color_scale,\n          linecol=NULL,\n          tracecol=NULL,\n          density.info=\"density\",\n          denscol=\"blue\",\n          margins=c(11,11))\n\n# ------------------------------------------------------- #\n# Pilar Organizacion \n# ------------------------------------------------------- #\norganizacion <- pilares %>% dplyr::select(P5_1:P5_3, P6_3, P6_4, P7_1, P7_3, P8_2, P13_9, P13_11)\norganizacion  %>% glimpse\n\n# Analisis descriptivo\nfqTable4 <- organizacion  %>%\n  gather(measure, value) %>%\n  count(measure, value)\nnames(fqTable4) <- c(\"Variable\", \"Categoria\", \"Frecuencia\")\nfqTable4 <- fqTable4 %>% dplyr::mutate(Porcentaje = Frecuencia/nrow(fqTable4))\nfqTable4$Categoria <- factor(fqTable4$Categoria, levels = c(\"Totalmente en desacuerdo\",\n                                                            \"En desacuerdo\",\n                                                            \"Ni de acuerdo ni en desacuerdo\",\n                                                            \"De acuerdo\",\n                                                            \"Totalmente de acuerdo\"), ordered = T)\n\n# Plot it (SAVE IT!!!!)\nx11()\ngg <- fqTable4 %>% ggplot(aes(x = Categoria, y = Porcentaje*100)) +\n  geom_bar(stat = \"identity\") +\n  xlab(\"\") + ylab(\"Porcentaje (%)\") +\n  coord_flip() +\n  facet_wrap(~ Variable, scales = \"free\") +\n  theme_bw() +\n  theme(strip.text = element_text(size = 12, face = \"bold\")) +\n  theme(axis.title.x = element_text(size = 13, face = 'bold'),\n        axis.title.y = element_text(size = 13, face = 'bold'),\n        axis.text = element_text(size = 12))\nggsave(\"../_results/_descriptive_analysis/frecuencias_organizacion.png\", plot = gg, width = 22, height = 10, units = \"in\"); rm(fqTable4, gg)\n\n\noptions(warn=-1)\np.chisq4 = matrix(0, nrow=ncol(organizacion), ncol=ncol(organizacion), byrow=T)\nfor(i in 1:ncol(organizacion)){\n  for(j in 1:ncol(organizacion)){\n    p.chisq4[i,j] = round(chisq.test(organizacion[,i],organizacion[,j])$p.value,3)\n  }\n}; rm(i); rm(j)\n\ndiag(p.chisq4) = NA\ncolnames(p.chisq4) = colnames(organizacion)\nrownames(p.chisq4) = colnames(organizacion)\n\ncolor_scale = colorRampPalette(c(\"tomato3\",\"lightyellow\",\"lightseagreen\"), space=\"rgb\")(50)\n# png('./_results/chi_test.png', height = 7, width = 7, units = \"in\", res = 300)\nheatmap.2(p.chisq4,\n          main=\"Independence test Organization\",\n          key.title=\"Chi-square test\",\n          key.xlab=\"p-value\",\n          Rowv=F,\n          Colv=NULL,\n          col=color_scale,\n          linecol=NULL,\n          tracecol=NULL,\n          density.info=\"density\",\n          denscol=\"blue\",\n          margins=c(11,11))\n\n#----------------------------------------------------------#\n# Analisis Canonico Tecnologia / Aprendizaje \n#----------------------------------------------------------#\nsuppressMessages(library(GGally))\nsuppressMessages(library(CCA))\n\nkm_data <- read.spss(file = \"../_data/Base GConocimiento PymeS  Valle_2017.sav\", to.data.frame = T, use.value.labels = F) # F\naprendizaje <- km_data %>% dplyr::select(P5_4, P5_5, P6_1, P6_2, P6_5, P7_2, P8_1, P13_13:P13_16)\ntecnologia <- km_data %>% dplyr::select(P3_4, P5_6, P7_4, P7_5, P11_1:P11_5, P13_5, P13_6, P13_7, P13_8)\n\ncorrplot(cor(cbind(aprendizaje, tecnologia)), method = \"square\")\n\n# Y: aprendizaje\n# X: tecnologia\ncc1 <- cc(tecnologia, aprendizaje) \ncc1$cor[1]\ncc1$cor[1:3]\n\ncc1[3:4]\n\ncc2 <- comput(tecnologia, aprendizaje, cc1)\ncc2[3:6]\ncc2[3:6]$corr.X.xscores %>% View\ncc2[3:6]$corr.Y.yscores %>% View\n\nggplot(data = data.frame(P7_2 = aprendizaje$P7_2, P7_5 = tecnologia$P7_5), aes(x = P7_2, y = P7_5, size = 28, alpha = .6)) + geom_point()\n\n# Tests of canonical dimensions\nev <- (1 - cc1$cor^2)\n\nn <- dim(aprendizaje)[1]\np <- length(aprendizaje)\nq <- length(tecnologia)\nk <- min(p, q)\nm <- n - 3/2 - (p + q)/2\n\nw <- rev(cumprod(rev(ev)))\n\n# initialize\nd1 <- d2 <- f <- vector(\"numeric\", k)\n\nfor (i in 1:k) {\n  s <- sqrt((p^2 * q^2 - 4)/(p^2 + q^2 - 5))\n  si <- 1/s\n  d1[i] <- p * q\n  d2[i] <- m * s - p * q/2 + 1\n  r <- (1 - w[i]^si)/w[i]^si\n  f[i] <- r * d2[i]/d1[i]\n  p <- p - 1\n  q <- q - 1\n}\n\npv <- pf(f, d1, d2, lower.tail = FALSE)\n(dmat <- cbind(WilksL = w, F = f, df1 = d1, df2 = d2, p = pv))\n\n# standardized psych canonical coefficients diagonal matrix of apre sd's\ns1 <- diag(sqrt(diag(cov(aprendizaje))))\ns1 %*% cc1$xcoef\n# standardized psych canonical coefficients diagonal matrix of tec sd's\ns2 <- diag(sqrt(diag(cov(tecnologia))))\ns2 %*% cc1$ycoef\n\n#----------------------------------------------------------#\n# Cuantificacion optima de variables\n#----------------------------------------------------------#\n\nlibrary(homals)\n\n### Aprendizaje\nfaData   <- all_data[,mtch_fa]\nfaHomals <- homals(faData, active=rep(TRUE, ncol(faData)), level='ordinal', sets=list(1:ncol(faData)))\nfaQuan   <- faHomals$low.rank # Quantified variables\nfaDataqF <- faData\n\nfor(i in 1:ncol(faDataqF)){\n  \n  faDataqF[,i] <- as.character(faDataqF[,i])\n  dfQuan <- as.data.frame(faQuan[[i]])\n  \n  for(j in 1:length(rownames(dfQuan))){\n    mtch <- which(faDataqF[,i]==rownames(dfQuan)[j])\n    if(length(mtch)>0){\n      faDataqF[,i][which(faDataqF[,i]==rownames(dfQuan)[j])] <- dfQuan[j,1]\n    }\n  }\n  \n  faDataqF[,i] <- as.numeric(faDataqF[,i])\n  \n}; rm(i,j,mtch)\nrm(faData, faHomals, dfQuan, faQuan)\n\n",
    "created" : 1503615934918.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "221792562",
    "id" : "9BA23C8A",
    "lastKnownWriteTime" : 1504904224,
    "last_content_update" : 1504904224371,
    "path" : "D:/ToBackup/repositories/personal/_knowledge_management_project_univalle/_scripts/loading_and_exploring_data.R",
    "project_path" : "loading_and_exploring_data.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}